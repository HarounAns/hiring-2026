<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pam AI Team Structure - January 2026</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f1a;
            min-height: 100vh;
            color: #fff;
            overflow: hidden;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 30px;
            background: rgba(15, 15, 26, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header h1 {
            font-weight: 400;
            font-size: 1.4rem;
        }

        .header-stats {
            display: flex;
            gap: 30px;
        }

        .header-stat {
            text-align: center;
        }

        .header-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4ade80;
        }

        .header-stat-label {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .controls {
            position: fixed;
            top: 90px;
            left: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .control-btn.active {
            background: #4ade80;
            color: #000;
            border-color: #4ade80;
        }

        .zoom-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            display: flex;
            gap: 5px;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        #chart {
            width: 100vw;
            height: 100vh;
            cursor: grab;
        }

        #chart:active {
            cursor: grabbing;
        }

        .node {
            cursor: pointer;
        }

        .node-card {
            rx: 12;
            ry: 12;
            filter: drop-shadow(0 4px 12px rgba(0,0,0,0.3));
            transition: all 0.2s;
        }

        .node:hover .node-card {
            filter: drop-shadow(0 8px 24px rgba(0,0,0,0.5));
        }

        .node-name {
            font-weight: 600;
            font-size: 13px;
            fill: #fff;
        }

        .node-role {
            font-size: 10px;
            fill: #999;
        }

        .node-team {
            font-size: 9px;
            fill: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .link {
            fill: none;
            stroke: rgba(255,255,255,0.15);
            stroke-width: 2;
        }

        .proposed .node-card {
            stroke-dasharray: 5,5;
            opacity: 0.7;
        }

        .proposed-badge {
            font-size: 8px;
            fill: #000;
            font-weight: 700;
        }

        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(15, 15, 26, 0.9);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .legend-title {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.8rem;
            color: #999;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 4px;
        }

        .tooltip {
            position: fixed;
            background: rgba(30, 30, 50, 0.95);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 200;
            max-width: 250px;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .tooltip-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tooltip-role {
            color: #999;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .tooltip-team {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .view-toggle {
            position: fixed;
            top: 90px;
            right: 30px;
            z-index: 100;
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .view-btn {
            background: transparent;
            border: none;
            color: #fff;
            padding: 10px 16px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .view-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        .view-btn.active {
            background: #4ade80;
            color: #000;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Pam AI Team Structure</h1>
        <div class="header-stats">
            <div class="header-stat">
                <div class="header-stat-value" id="total-count">27</div>
                <div class="header-stat-label">Current</div>
            </div>
            <div class="header-stat">
                <div class="header-stat-value" id="eng-count">16</div>
                <div class="header-stat-label">Engineering</div>
            </div>
            <div class="header-stat">
                <div class="header-stat-value" id="proposed-count" style="color: #f59e0b;">+6</div>
                <div class="header-stat-label">Proposed</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="control-btn" id="toggle-proposed" onclick="toggleProposed()">
            <span>üëÅ</span> Show Proposed Hires
        </button>
        <button class="control-btn" onclick="resetView()">
            <span>‚ü≤</span> Reset View
        </button>
        <button class="control-btn" onclick="expandAll()">
            <span>‚äï</span> Expand All
        </button>
        <button class="control-btn" onclick="collapseAll()">
            <span>‚äñ</span> Collapse All
        </button>
    </div>

    <div class="view-toggle">
        <button class="view-btn active" onclick="setView('tree')">Tree</button>
        <button class="view-btn" onclick="setView('radial')">Radial</button>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" onclick="zoomIn()">+</button>
        <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
    </div>

    <div class="legend">
        <div class="legend-title">Departments</div>
        <div class="legend-item">
            <div class="legend-color" style="background: #4a90a4;"></div>
            <span>Executive</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #6b8e23;"></div>
            <span>Engineering</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #d4a574;"></div>
            <span>Operations</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9b7bb8;"></div>
            <span>Customer Success</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #e07b53;"></div>
            <span>Product</span>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <svg id="chart"></svg>

    <script>
        let teamData = null;
        let metaData = null;

        const colors = {
            exec: "#4a90a4",
            eng: "#6b8e23",
            ops: "#d4a574",
            cs: "#9b7bb8",
            pm: "#e07b53",
            sales: "#666"
        };

        let showProposed = false;
        let currentView = 'tree';
        let svg, g, zoom, root;
        const nodeWidth = 160;
        const nodeHeight = 60;

        function init() {
            svg = d3.select("#chart");
            const width = window.innerWidth;
            const height = window.innerHeight;

            svg.attr("width", width).attr("height", height);

            zoom = d3.zoom()
                .scaleExtent([0.3, 3])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                });

            svg.call(zoom);

            g = svg.append("g");

            root = d3.hierarchy(teamData);

            updateChart();
            resetView();
        }

        function filterData(node) {
            if (!showProposed && node.data.proposed) return null;

            const filtered = {
                ...node.data,
                children: node.children ?
                    node.children
                        .map(c => filterData(c))
                        .filter(c => c !== null)
                        .map(c => c) :
                    undefined
            };

            if (filtered.children && filtered.children.length === 0) {
                delete filtered.children;
            }

            return filtered;
        }

        function updateChart() {
            g.selectAll("*").remove();

            // Filter based on proposed toggle
            const filteredData = filterProposedData(teamData);
            root = d3.hierarchy(filteredData);

            const width = window.innerWidth;
            const height = window.innerHeight;

            if (currentView === 'tree') {
                const treeLayout = d3.tree()
                    .nodeSize([nodeWidth + 40, nodeHeight + 80]);

                treeLayout(root);

                // Draw links
                g.selectAll(".link")
                    .data(root.links())
                    .join("path")
                    .attr("class", "link")
                    .attr("d", d3.linkVertical()
                        .x(d => d.x)
                        .y(d => d.y));

                // Draw nodes
                const nodes = g.selectAll(".node")
                    .data(root.descendants())
                    .join("g")
                    .attr("class", d => `node ${d.data.proposed ? 'proposed' : ''}`)
                    .attr("transform", d => `translate(${d.x - nodeWidth/2}, ${d.y - nodeHeight/2})`)
                    .on("mouseover", showTooltip)
                    .on("mouseout", hideTooltip)
                    .on("click", toggleNode);

                drawNodes(nodes);

            } else {
                // Radial view
                const radius = Math.min(width, height) / 2 - 150;

                const treeLayout = d3.tree()
                    .size([2 * Math.PI, radius])
                    .separation((a, b) => (a.parent == b.parent ? 1 : 2) / a.depth);

                treeLayout(root);

                // Draw links
                g.selectAll(".link")
                    .data(root.links())
                    .join("path")
                    .attr("class", "link")
                    .attr("d", d3.linkRadial()
                        .angle(d => d.x)
                        .radius(d => d.y));

                // Draw nodes
                const nodes = g.selectAll(".node")
                    .data(root.descendants())
                    .join("g")
                    .attr("class", d => `node ${d.data.proposed ? 'proposed' : ''}`)
                    .attr("transform", d => `
                        rotate(${d.x * 180 / Math.PI - 90})
                        translate(${d.y}, 0)
                        rotate(${d.x >= Math.PI ? 180 : 0})
                    `)
                    .on("mouseover", showTooltip)
                    .on("mouseout", hideTooltip)
                    .on("click", toggleNode);

                drawNodes(nodes);
            }
        }

        function filterProposedData(data) {
            if (!showProposed && data.proposed) return null;

            const result = { ...data };

            if (data.children) {
                result.children = data.children
                    .map(c => filterProposedData(c))
                    .filter(c => c !== null);

                if (result.children.length === 0) {
                    delete result.children;
                }
            }

            return result;
        }

        function drawNodes(nodes) {
            // Card background
            nodes.append("rect")
                .attr("class", "node-card")
                .attr("width", nodeWidth)
                .attr("height", nodeHeight)
                .attr("fill", d => {
                    const baseColor = colors[d.data.department] || colors.eng;
                    return d.data.proposed ? `${baseColor}66` : `${baseColor}33`;
                })
                .attr("stroke", d => colors[d.data.department] || colors.eng)
                .attr("stroke-width", 2);

            // Proposed badge
            nodes.filter(d => d.data.proposed)
                .append("rect")
                .attr("x", nodeWidth - 50)
                .attr("y", 5)
                .attr("width", 45)
                .attr("height", 16)
                .attr("rx", 4)
                .attr("fill", "#f59e0b");

            nodes.filter(d => d.data.proposed)
                .append("text")
                .attr("class", "proposed-badge")
                .attr("x", nodeWidth - 28)
                .attr("y", 16)
                .attr("text-anchor", "middle")
                .text("Q1");

            // Name
            nodes.append("text")
                .attr("class", "node-name")
                .attr("x", nodeWidth / 2)
                .attr("y", 24)
                .attr("text-anchor", "middle")
                .text(d => d.data.name);

            // Role
            nodes.append("text")
                .attr("class", "node-role")
                .attr("x", nodeWidth / 2)
                .attr("y", 40)
                .attr("text-anchor", "middle")
                .text(d => truncate(d.data.role, 22));

            // Team badge
            nodes.filter(d => d.data.team)
                .append("text")
                .attr("class", "node-team")
                .attr("x", nodeWidth / 2)
                .attr("y", 54)
                .attr("text-anchor", "middle")
                .text(d => d.data.team);

            // Expand indicator
            nodes.filter(d => d.children || d._children)
                .append("circle")
                .attr("cx", nodeWidth / 2)
                .attr("cy", nodeHeight + 8)
                .attr("r", 8)
                .attr("fill", d => d._children ? "#4ade80" : "rgba(255,255,255,0.2)")
                .attr("stroke", "rgba(255,255,255,0.3)")
                .attr("stroke-width", 1);

            nodes.filter(d => d.children || d._children)
                .append("text")
                .attr("x", nodeWidth / 2)
                .attr("y", nodeHeight + 12)
                .attr("text-anchor", "middle")
                .attr("fill", d => d._children ? "#000" : "#fff")
                .attr("font-size", "12px")
                .text(d => d._children ? "+" : "‚àí");
        }

        function truncate(str, n) {
            return str.length > n ? str.substr(0, n - 1) + "‚Ä¶" : str;
        }

        function showTooltip(event, d) {
            const tooltip = document.getElementById("tooltip");
            tooltip.innerHTML = `
                <div class="tooltip-name">${d.data.name}</div>
                <div class="tooltip-role">${d.data.role}</div>
                ${d.data.team ? `<span class="tooltip-team" style="background: ${colors[d.data.department]}33; color: ${colors[d.data.department]}">${d.data.team}</span>` : ''}
                ${d.data.proposed ? '<br><span style="color: #f59e0b; font-size: 0.75rem; margin-top: 8px; display: block;">Q1 Proposed Hire</span>' : ''}
            `;
            tooltip.style.left = (event.pageX + 15) + "px";
            tooltip.style.top = (event.pageY - 10) + "px";
            tooltip.classList.add("visible");
        }

        function hideTooltip() {
            document.getElementById("tooltip").classList.remove("visible");
        }

        function toggleNode(event, d) {
            if (d.children) {
                d._children = d.children;
                d.children = null;
            } else if (d._children) {
                d.children = d._children;
                d._children = null;
            }
            updateChart();
        }

        function toggleProposed() {
            showProposed = !showProposed;
            const btn = document.getElementById("toggle-proposed");
            btn.classList.toggle("active", showProposed);
            btn.innerHTML = showProposed ?
                "<span>üëÅ</span> Hide Proposed Hires" :
                "<span>üëÅ</span> Show Proposed Hires";

            document.getElementById("proposed-count").style.display = showProposed ? "block" : "none";

            updateChart();
            resetView();
        }

        function resetView() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            svg.transition()
                .duration(500)
                .call(zoom.transform, d3.zoomIdentity
                    .translate(width / 2, currentView === 'radial' ? height / 2 : 150)
                    .scale(0.8));
        }

        function zoomIn() {
            svg.transition().duration(300).call(zoom.scaleBy, 1.3);
        }

        function zoomOut() {
            svg.transition().duration(300).call(zoom.scaleBy, 0.7);
        }

        function expandAll() {
            root.descendants().forEach(d => {
                if (d._children) {
                    d.children = d._children;
                    d._children = null;
                }
            });
            updateChart();
        }

        function collapseAll() {
            root.descendants().forEach(d => {
                if (d.children && d.depth > 0) {
                    d._children = d.children;
                    d.children = null;
                }
            });
            updateChart();
        }

        function setView(view) {
            currentView = view;
            document.querySelectorAll(".view-btn").forEach(btn => {
                btn.classList.toggle("active", btn.textContent.toLowerCase() === view);
            });
            updateChart();
            resetView();
        }

        window.addEventListener("resize", () => {
            svg.attr("width", window.innerWidth).attr("height", window.innerHeight);
            resetView();
        });

        // Load data from JSON file
        async function loadData() {
            try {
                const response = await fetch('team-data.json');
                const data = await response.json();
                teamData = data.team;
                metaData = data.meta;

                // Update header with meta data
                document.querySelector('.header h1').textContent = metaData.title;
                document.getElementById('total-count').textContent = metaData.stats.current;
                document.getElementById('eng-count').textContent = metaData.stats.engineering;
                document.getElementById('proposed-count').textContent = '+' + metaData.stats.proposed;

                init();
            } catch (error) {
                console.error('Failed to load team data:', error);
                document.body.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; height: 100vh; flex-direction: column; gap: 20px;">
                        <h1 style="color: #f87171;">Failed to load team data</h1>
                        <p style="color: #888;">Make sure team-data.json exists and you're running from a local server.</p>
                        <p style="color: #666; font-size: 0.9rem;">Run: npx serve . or python -m http.server</p>
                    </div>
                `;
            }
        }

        loadData();
    </script>
</body>
</html>
